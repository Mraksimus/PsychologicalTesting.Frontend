import React, { useState, useEffect } from 'react';
import { useParams, useNavigate } from 'react-router-dom';
import {
    Container,
    Stack,
    Card,
    Group,
    Button,
    Title,
    Text,
    Progress,
    Badge,
} from '@mantine/core';
import Header from '../components/Header';

interface Question {
    id: number;
    text: string;
    options: string[];
}

interface TestDataType {
    title: string;
    category: string;
    questions: Question[];
}

// ВСЕ 12 ТЕСТОВ
const testsData: { [key: number]: TestDataType } = {
    1: {
        title: 'Тест на уровень стресса',
        category: 'Психология',
        questions: [
            { id: 1, text: 'Как часто вы испытываете чувство перегруженности?', options: ['Никогда', 'Несколько раз в месяц', 'Еженедельно', 'Практически ежедневно'] },
            { id: 2, text: 'Влияет ли стресс на качество вашего сна?', options: ['Не влияет совсем', 'Иногда нарушает', 'Часто нарушает', 'Полностью нарушает'] },
            { id: 3, text: 'Какой ваш основной способ справиться со стрессом?', options: ['Физические упражнения', 'Разговор с друзьями', 'Прием пищи или алкоголь', 'Избегание проблемы'] },
            { id: 4, text: 'Как часто вы берете отпуск или выходные дни?', options: ['Регулярно отдыхаю', 'Несколько раз в год', 'Редко', 'Практически не беру'] },
            { id: 5, text: 'Оцените ваш уровень стрессоустойчивости:', options: ['Высокий - я легко справляюсь с проблемами', 'Выше среднего', 'Средний', 'Низкий - я быстро переутомляюсь'] },
            { id: 6, text: 'Насколько вам хватает часов сна для восстановления?', options: ['Более чем достаточно (8+ часов)', 'Достаточно (7-8 часов)', 'Немного не хватает (5-7)', 'Явно недостаточно (менее 5)'] },
            { id: 7, text: 'Как часто вы медитируете или практикуете релаксацию?', options: ['Ежедневно', 'Несколько раз в неделю', 'Редко', 'Никогда'] },
            { id: 8, text: 'Испытываете ли вы физические симптомы стресса?', options: ['Нет', 'Иногда', 'Часто', 'Постоянно (напряжение, боли)'] },
            { id: 9, text: 'Как вы относитесь к своей нынешней работе/учебе?', options: ['С энтузиазмом', 'Нормально', 'Неохотно', 'Испытываю отвращение'] },
            { id: 10, text: 'Как часто вы обращаетесь к психологу или психотерапевту?', options: ['Когда это необходимо', 'Несколько раз в год', 'Редко думаю об этом', 'Никогда не обращался'] }
        ]
    },
    2: {
        title: 'Тест на эмоциональный интеллект',
        category: 'Психология',
        questions: [
            { id: 1, text: 'Как вы реагируете на конструктивную критику?', options: ['Внимательно слушаю и учусь', 'Сначала обижаюсь, потом анализирую', 'Становлюсь защитным', 'Игнорирую полностью'] },
            { id: 2, text: 'Насколько хорошо вы распознаете эмоции других людей?', options: ['Отлично - замечаю малейшие изменения', 'Хорошо - обычно понимаю', 'Удовлетворительно', 'Плохо - часто не замечаю'] },
            { id: 3, text: 'Как вы управляете своими эмоциями в конфликтной ситуации?', options: ['Спокойно и конструктивно', 'Стараюсь оставаться спокойным', 'Теряю над собой контроль', 'Ухожу от ситуации'] },
            { id: 4, text: 'Как хорошо вы понимаете свои собственные эмоции?', options: ['Очень хорошо - четко их разбираю', 'Хорошо обычно', 'Иногда теряюсь', 'Часто не понимаю, что чувствую'] },
            { id: 5, text: 'Умеете ли вы адаптировать свое поведение к другим людям?', options: ['Легко адаптируюсь', 'Обычно адаптируюсь', 'Иногда сложно', 'Предпочитаю быть собой'] },
            { id: 6, text: 'Насколько вы эмпатичны к чувствам других?', options: ['Очень - часто сопереживаю', 'Достаточно', 'Средне', 'Слабо - фокусируюсь на себе'] },
            { id: 7, text: 'Как часто вы размышляете о свои чувствах и поведении?', options: ['Постоянно', 'Регулярно', 'Иногда', 'Редко или никогда'] },
            { id: 8, text: 'Способны ли вы эффективно общаться при высоком эмоциональном напряжении?', options: ['Да, сохраняю ясность', 'Обычно удается', 'Иногда теряюсь', 'Нет, становлюсь нерациональным'] },
            { id: 9, text: 'Как вы помогаете близким людям справляться с эмоциями?', options: ['Активно слушаю и поддерживаю', 'Стараюсь помочь', 'Затрудняюсь с этим', 'Предпочитаю не вмешиваться'] },
            { id: 10, text: 'Насколько вы мотивированы своими эмоциями?', options: ['Позитивно мотивирован эмоциями', 'Обычно хорошо', 'Иногда теряю мотивацию', 'Часто неконтролируемо'] }
        ]
    },
    3: {
        title: 'Тест на адаптацию к изменениям',
        category: 'Развитие',
        questions: [
            { id: 1, text: 'Как вы обычно реагируете на неожиданные изменения?', options: ['С интересом и готовностью', 'Спокойно принимаю', 'Вначале сопротивляюсь', 'Паникую'] },
            { id: 2, text: 'Насколько быстро вы адаптируетесь к новым условиям?', options: ['Очень быстро', 'В среднем', 'Медленно', 'Очень медленно или не адаптируюсь'] },
            { id: 3, text: 'Как часто вы добровольно инициируете перемены в своей жизни?', options: ['Регулярно - люблю новое', 'Иногда', 'Редко', 'Предпочитаю стабильность'] },
            { id: 4, text: 'Ваш первый шаг при встрече с неизвестностью:', options: ['Собираю информацию и планирую', 'Выполняю постепенно', 'Жду указаний', 'Избегаю ситуации'] },
            { id: 5, text: 'Как вы воспринимаете ошибки в процессе адаптации?', options: ['Как ценный опыт', 'Как нормальную часть процесса', 'Расстраиваюсь', 'Как личный отказ'] },
            { id: 6, text: 'Гибко ли вы мыслите при решении новых проблем?', options: ['Очень гибко - нахожу альтернативы', 'Обычно гибко', 'Иногда застреваю', 'Предпочитаю известные решения'] },
            { id: 7, text: 'Как часто вы учитесь новому или осваиваете новые навыки?', options: ['Постоянно', 'Регулярно', 'Иногда', 'Редко'] },
            { id: 8, text: 'Имеете ли вы план на случай неудачи или осложнений?', options: ['Всегда готовлю альтернативы', 'Обычно имею план B', 'Иногда думаю об этом', 'Не планирую'] },
            { id: 9, text: 'Как вы поддерживаете себя во время стрессовых перемен?', options: ['Активно ищу поддержку и ресурсы', 'Полагаюсь на близких', 'Стараюсь справиться сам', 'Замыкаюсь в себе'] },
            { id: 10, text: 'Видите ли вы возможности в сложных ситуациях?', options: ['Часто - концентрируюсь на благе', 'Иногда', 'Редко', 'Вижу только проблемы'] }
        ]
    },
    4: {
        title: 'Тест на тревожность',
        category: 'Психология',
        questions: [
            { id: 1, text: 'Как часто вы испытываете беспокойство без явной причины?', options: ['Никогда', 'Редко', 'Иногда', 'Часто'] },
            { id: 2, text: 'Как вам удается справляться с тревогой?', options: ['Легко отвлекаюсь или она проходит', 'Обычно справляюсь', 'С трудом', 'Не справляюсь'] },
            { id: 3, text: 'Влияет ли тревога на вашу работоспособность и концентрацию?', options: ['Не влияет', 'Иногда влияет', 'Часто мешает', 'Полностью парализует'] },
            { id: 4, text: 'Испытываете ли вы физические симптомы тревоги?', options: ['Нет никогда', 'Редко', 'Иногда', 'Часто (учащенное сердцебиение, потливость)'] },
            { id: 5, text: 'Как часто вы волнуетесь перед важными событиями?', options: ['Почти не волнуюсь', 'Нормальное волнение', 'Сильно волнуюсь', 'Паникую'] },
            { id: 6, text: 'Имеете ли вы инструменты для управления тревогой?', options: ['Да, эффективные техники', 'Кое-какие есть', 'Слабые попытки', 'Нет никаких'] },
            { id: 7, text: 'Как долго обычно длится приступ тревоги?', options: ['Минуты', 'От 10 минут до часа', 'Несколько часов', 'Целый день или дольше'] },
            { id: 8, text: 'Избегаете ли вы ситуаций из-за тревоги?', options: ['Нет - не позволяю этому себя ограничивать', 'Редко', 'Иногда', 'Часто'] },
            { id: 9, text: 'Обращались ли вы к специалисту по поводу тревоги?', options: ['Да, и помогло', 'Да, но помогло мало', 'Думаю об этом', 'Нет'] },
            { id: 10, text: 'Как вы оцениваете уровень вашей тревожности?', options: ['Низкий', 'Умеренный', 'Повышенный', 'Критический'] }
        ]
    },
    5: {
        title: 'Тест на выгорание',
        category: 'Профессия',
        questions: [
            { id: 1, text: 'Как вы чувствуете себя по утрам в рабочие дни?', options: ['Бодрый и готов к дню', 'Нормально', 'Усталый', 'Полностью измучен'] },
            { id: 2, text: 'Испытываете ли вы эмоциональное истощение?', options: ['Нет', 'Редко', 'Иногда', 'Постоянно'] },
            { id: 3, text: 'Как вы относитесь к своим профессиональным обязанностям?', options: ['С энтузиазмом', 'Нейтрально', 'Неохотно', 'С отвращением'] },
            { id: 4, text: 'Как часто вы берете отпуск и отдыхаете?', options: ['Регулярно отдыхаю', 'Несколько раз в год', 'Редко', 'Практически не беру'] },
            { id: 5, text: 'Как работа влияет на ваше здоровье и благополучие?', options: ['Положительно', 'Нейтрально', 'Негативно', 'Серьезно ухудшает'] },
            { id: 6, text: 'Испытываете ли вы цинизм в отношении работы?', options: ['Нет - сохраняю позитив', 'Редко', 'Иногда', 'Часто'] },
            { id: 7, text: 'Насколько вы чувствуете результативность своей работы?', options: ['Высокую - вижу результаты', 'Среднюю', 'Низкую', 'Почти никакую'] },
            { id: 8, text: 'Как часто вы думаете о смене работы?', options: ['Редко или никогда', 'Иногда', 'Часто', 'Постоянно'] },
            { id: 9, text: 'Влияет ли работа на ваши отношения с близкими?', options: ['Не влияет', 'Иногда влияет', 'Часто создает конфликты', 'Серьезно портит отношения'] },
            { id: 10, text: 'Рассматриваете ли вы выгорание как проблему в своей жизни?', options: ['Нет проблем', 'Небольшие признаки', 'Есть симптомы', 'Серьезная проблема'] }
        ]
    },
    6: {
        title: 'Тест коммуникативных навыков',
        category: 'Развитие',
        questions: [
            { id: 1, text: 'Насколько вам комфортно общаться с незнакомыми людьми?', options: ['Очень комфортно', 'Обычно комфортно', 'Немного неловко', 'Очень неловко'] },
            { id: 2, text: 'Как хорошо вы умеете слушать других?', options: ['Отлично - полностью сосредоточусь', 'Хорошо', 'Удовлетворительно', 'Плохо - часто отвлекаюсь'] },
            { id: 3, text: 'Ясно ли вы выражаете свои мысли и идеи?', options: ['Очень ясно', 'Обычно ясно', 'Иногда неловко формулирую', 'Часто непонятно'] },
            { id: 4, text: 'Как вы разрешаете конфликты в общении?', options: ['Конструктивно и дипломатично', 'Обычно хорошо', 'Иногда теряюсь', 'Часто эскалирую конфликт'] },
            { id: 5, text: 'Насколько вы готовы к командной работе?', options: ['Очень - люблю сотрудничество', 'Хорошо готов', 'Среднее предпочтение', 'Предпочитаю работать один'] },
            { id: 6, text: 'Как вы справляетесь с критикой в общении?', options: ['Спокойно и конструктивно', 'Обычно нормально', 'Становлюсь защитным', 'Очень обижаюсь'] },
            { id: 7, text: 'Насколько вы эмпатичны в общении?', options: ['Очень - стараюсь понять других', 'Хорошо', 'Среднее', 'Слабо - фокусируюсь на себе'] },
            { id: 8, text: 'Как часто вы инициируете разговоры?', options: ['Часто', 'Иногда', 'Редко', 'Практически никогда'] },
            { id: 9, text: 'Насколько уверены вы в публичном выступлении?', options: ['Очень уверен', 'Обычно уверен', 'Немного нервничаю', 'Очень волнуюсь'] },
            { id: 10, text: 'Как люди оценивают ваши коммуникативные навыки?', options: ['Как отличные', 'Как хорошие', 'Как средние', 'Как слабые'] }
        ]
    },
    7: {
        title: 'Тест на самооценку',
        category: 'Психология',
        questions: [
            { id: 1, text: 'Насколько вы в целом довольны собой?', options: ['Очень - люблю себя', 'Довольно', 'Средне', 'Не доволен'] },
            { id: 2, text: 'Как вы относитесь к своим ошибкам?', options: ['Учусь на них и развиваюсь', 'Принимаю как нормальное', 'Расстраиваюсь', 'Осуждаю себя'] },
            { id: 3, text: 'Верите ли вы в свои способности?', options: ['Да, полностью верю', 'Обычно верю', 'Иногда сомневаюсь', 'Часто сомневаюсь'] },
            { id: 4, text: 'Как вы реагируете на похвалу?', options: ['С благодарностью и уверенностью', 'Принимаю спокойно', 'Смущаюсь', 'Не верю'] },
            { id: 5, text: 'Ставите ли вы себе высокие цели?', options: ['Да, амбициозные', 'Обычно реалистичные', 'Скромные', 'Не ставлю'] },
            { id: 6, text: 'Как часто вы испытываете чувство вины?', options: ['Редко - считаю себя достойным', 'Иногда', 'Часто', 'Постоянно'] },
            { id: 7, text: 'Насколько вы себя уважаете?', options: ['Сильно уважаю', 'Уважаю', 'Нейтрально', 'Плохо отношусь к себе'] },
            { id: 8, text: 'Как вы справляетесь с неудачами?', options: ['Быстро восстанавливаюсь и пробую снова', 'Обычно справляюсь', 'Теряю веру в себя', 'Впадаю в депрессию'] },
            { id: 9, text: 'Сравниваете ли вы себя с другими?', options: ['Нет - сосредоточусь на своем', 'Редко', 'Иногда', 'Часто - и это угнетает'] },
            { id: 10, text: 'Как вы оцениваете уровень своей самооценки?', options: ['Высокий', 'Выше среднего', 'Средний', 'Низкий'] }
        ]
    },
    8: {
        title: 'Тест на профориентацию',
        category: 'Профессия',
        questions: [
            { id: 1, text: 'Что для вас наиболее важно в работе?', options: ['Интерес и развитие', 'Стабильность и безопасность', 'Высокий доход', 'Баланс всех факторов'] },
            { id: 2, text: 'Предпочитаете ли вы работать в команде или самостоятельно?', options: ['В команде - люблю сотрудничество', 'Тет-а-тет или малая группа', 'Предпочитаю независимость', 'Зависит от проекта'] },
            { id: 3, text: 'Какой тип работы вас привлекает?', options: ['Творческая и инновационная', 'Аналитическая и структурированная', 'Практическая и техническая', 'Управленческая'] },
            { id: 4, text: 'Как вы видите свою карьеру в будущем?', options: ['Хочу развиваться и расти', 'Хочу специализироваться глубже', 'Хочу управлять людьми', 'Пока не определился'] },
            { id: 5, text: 'Готовы ли вы к переквалификации и обучению?', options: ['Да, активно развиваюсь', 'Когда необходимо', 'Скорее нет', 'Нет'] },
            { id: 6, text: 'Какое рабочее окружение для вас идеально?', options: ['Динамичное и творческое', 'Спокойное и порядочное', 'Конкурентное и стимулирующее', 'Гибкое'] },
            { id: 7, text: 'Как вы относитесь к риску в карьере?', options: ['Готов идти на риск ради возможностей', 'Предпочитаю определенность', 'Боюсь потерять стабильность', 'Зависит от обстоятельств'] },
            { id: 8, text: 'Какие ваши сильные стороны в работе?', options: ['Креативность и инновации', 'Внимание к деталям и система', 'Лидерство и коммуникация', 'Технические навыки'] },
            { id: 9, text: 'Как часто вы думаете о смене профессионального направления?', options: ['Редко - доволен выбором', 'Иногда', 'Часто - не уверен', 'Постоянно ищу'] },
            { id: 10, text: 'Где вы видите себя через 5 лет?', options: ['На должности выше с большей ответственностью', 'Экспертом в своей области', 'В той же области, но более стабильно', 'В другой профессии'] }
        ]
    },
    9: {
        title: 'Тест на креативность',
        category: 'Развитие',
        questions: [
            { id: 1, text: 'Как часто вам приходят новые и оригинальные идеи?', options: ['Часто и самопроизвольно', 'Иногда', 'Редко', 'Практически никогда'] },
            { id: 2, text: 'Как вы подходите к решению сложных проблем?', options: ['Ищу нестандартные решения', 'Комбинирую известные методы', 'Следую стандартным подходам', 'Теряюсь'] },
            { id: 3, text: 'Боитесь ли вы экспериментировать и рисковать?', options: ['Нет - люблю пробовать новое', 'Иногда боюсь', 'Часто волнуюсь', 'Избегаю неопробованного'] },
            { id: 4, text: 'Как хорошо вы видите необычные связи между идеями?', options: ['Отлично - вижу новые комбинации', 'Хорошо', 'Средне', 'Плохо - думаю прямолинейно'] },
            { id: 5, text: 'Как часто вы воплощаете свои идеи в реальность?', options: ['Часто - доводу до конца', 'Иногда', 'Редко - теряю интерес', 'Почти никогда'] },
            { id: 6, text: 'Как вы относитесь к критике ваших идей?', options: ['Конструктивно - совершенствую идею', 'Обычно спокойно', 'Немного обижаюсь', 'Очень обижаюсь'] },
            { id: 7, text: 'Насколько гибко вы мыслите?', options: ['Очень - легко меняю подход', 'Обычно гибко', 'Иногда застреваю', 'Предпочитаю один способ'] },
            { id: 8, text: 'Как часто вы выбираетесь из обыденной рутины?', options: ['Часто - ищу новые впечатления', 'Иногда', 'Редко', 'Люблю предсказуемость'] },
            { id: 9, text: 'Насколько вы открыты к чужим идеям?', options: ['Очень - впитываю новое', 'Обычно открыт', 'Иногда скептичен', 'Часто недоверчив'] },
            { id: 10, text: 'Оцените свой творческий потенциал:', options: ['Высокий', 'Выше среднего', 'Средний', 'Низкий'] }
        ]
    },
    10: {
        title: 'Тест на устойчивость к стрессу',
        category: 'Психология',
        questions: [
            { id: 1, text: 'Как быстро вы восстанавливаетесь после стрессовых ситуаций?', options: ['Очень быстро - за часы', 'Довольно быстро - за дни', 'Медленно - неделями', 'Очень долго - месяцами'] },
            { id: 2, text: 'Насколько сильную поддержку вы получаете в сложные периоды?', options: ['Сильную - есть люди и ресурсы', 'Хорошую', 'Слабую', 'Практически никакой'] },
            { id: 3, text: 'Как часто вы занимаетесь физическими упражнениями?', options: ['Регулярно - 3-5 раз в неделю', 'Несколько раз в неделю', 'Редко', 'Не занимаюсь'] },
            { id: 4, text: 'Насколько позитивно вы мыслите в сложных ситуациях?', options: ['Очень - вижу возможности', 'Обычно позитивно', 'Иногда теряю надежду', 'Часто пессимист'] },
            { id: 5, text: 'Есть ли у вас четкая жизненная цель?', options: ['Да - четкая и мотивирующая', 'Более-менее ясная', 'Туманная', 'Нет'] },
            { id: 6, text: 'Как вы справляетесь с неопределенностью?', options: ['Спокойно - адаптируюсь', 'Обычно справляюсь', 'Нервничаю', 'Паникую'] },
            { id: 7, text: 'Насколько хорошо вы контролируете свои эмоции?', options: ['Очень хорошо', 'Обычно хорошо', 'Иногда теряю контроль', 'Часто захлестывают'] },
            { id: 8, text: 'Как часто вы практикуете расслабление/медитацию?', options: ['Ежедневно', 'Несколько раз в неделю', 'Редко', 'Никогда'] },
            { id: 9, text: 'Насколько вы уверены в своих способностях справиться?', options: ['Очень уверен', 'Обычно уверен', 'Иногда сомневаюсь', 'Часто сомневаюсь'] },
            { id: 10, text: 'Оцените вашу общую стрессоустойчивость:', options: ['Высокая', 'Выше среднего', 'Средняя', 'Низкая'] }
        ]
    },
    11: {
        title: 'Тест на лидерские качества',
        category: 'Развитие',
        questions: [
            { id: 1, text: 'Берете ли вы инициативу в групповых ситуациях?', options: ['Часто - естественно становлюсь лидером', 'Иногда', 'Редко', 'Предпочитаю следовать'] },
            { id: 2, text: 'Как люди вас воспринимают?', options: ['Как лидера и авторитет', 'Как надежного человека', 'Как среднестатистического', 'Как ведомого'] },
            { id: 3, text: 'Насколько вы хороший мотиватор?', options: ['Отличный - вдохновляю людей', 'Хороший', 'Среднее', 'Плохой'] },
            { id: 4, text: 'Как быстро вы принимаете решения?', options: ['Уверенно и быстро', 'Обычно хорошо', 'Медленно и колеблюсь', 'Очень долго'] },
            { id: 5, text: 'Развиваете ли вы других людей?', options: ['Постоянно - передаю знания', 'Иногда', 'Редко', 'Не занимаюсь этим'] },
            { id: 6, text: 'Как вы справляетесь с конфликтами в команде?', options: ['Разрешаю конструктивно', 'Обычно справляюсь', 'С трудом', 'Избегаю конфликтов'] },
            { id: 7, text: 'Насколько вы ответственны за результаты?', options: ['Очень - берусь за результат', 'Обычно ответственен', 'Иногда увиливаю', 'Часто незаметно'] },
            { id: 8, text: 'Как вы относитесь к критике подчиненных?', options: ['Конструктивно - учусь', 'Обычно спокойно', 'Немного защищаюсь', 'Отвергаю'] },
            { id: 9, text: 'Способны ли вы вдохновить команду на большое дело?', options: ['Да - часто это происходит', 'Обычно', 'Иногда', 'Нет'] },
            { id: 10, text: 'Оцените ваши лидерские качества:', options: ['Выраженные - я прирожденный лидер', 'Хорошие', 'Средние', 'Слабые'] }
        ]
    },
    12: {
        title: 'Тест на эмоциональное выгорание',
        category: 'Психология',
        questions: [
            { id: 1, text: 'Чувствуете ли вы эмоциональное истощение в конце дня?', options: ['Нет - чувствую себя нормально', 'Иногда', 'Часто', 'Постоянно - полностью разбит'] },
            { id: 2, text: 'Как вы относитесь к людям, с которыми работаете?', options: ['Позитивно и с интересом', 'Нейтрально', 'С раздражением', 'Откровенно циничны'] },
            { id: 3, text: 'Ощущаете ли вы симптомы депрессии?', options: ['Нет', 'Иногда плохое настроение', 'Часто грустный', 'Постоянно в депрессии'] },
            { id: 4, text: 'Как ваша мотивация продолжать работу?', options: ['Высокая - люблю то, что делаю', 'Нормальная', 'Низкая - через силу', 'Отсутствует'] },
            { id: 5, text: 'Насколько вы отстранены от работы эмоционально?', options: ['Вовлечен и зацеплен', 'Обычно вовлечен', 'Становлюсь отстраненным', 'Полностью отстранен'] },
            { id: 6, text: 'Как часто вы думаете о прекращении?', options: ['Редко или никогда', 'Иногда', 'Часто', 'Постоянно'] },
            { id: 7, text: 'Влияет ли выгорание на вашу личную жизнь?', options: ['Не влияет', 'Иногда влияет', 'Часто создает проблемы', 'Серьезно портит'] },
            { id: 8, text: 'Ваш уровень ресурсов для восстановления?', options: ['Хороший - есть возможности отдыхать', 'Среднее', 'Низкий', 'Практически нет'] },
            { id: 9, text: 'Нужна ли вам помощь специалиста?', options: ['Нет - справляюсь', 'Может помочь', 'Да, хотел бы', 'Срочно нужна'] },
            { id: 10, text: 'Оцените ваш риск выгорания:', options: ['Низкий риск', 'Умеренный риск', 'Повышенный риск', 'Критический риск'] }
        ]
    }
};

const TestingPage: React.FC = () => {
    const { testId } = useParams<{ testId: string }>();
    const navigate = useNavigate();
    const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0);
    const [userAnswers, setUserAnswers] = useState<{ [key: number]: number }>({});

    const testIdNum = parseInt(testId || '1');
    const testData = testsData[testIdNum];
    const currentQuestion = testData.questions[currentQuestionIndex];
    const totalQuestions = testData.questions.length;
    const progress = ((currentQuestionIndex + 1) / totalQuestions) * 100;

    // Сохранение прогресса
    useEffect(() => {
        const progress = {
            testId: testIdNum,
            currentQuestionIndex,
            userAnswers,
            timestamp: Date.now()
        };
        localStorage.setItem(`testProgress_${testIdNum}`, JSON.stringify(progress));
    }, [currentQuestionIndex, userAnswers, testIdNum]);

    // Восстановление прогресса
    useEffect(() => {
        const savedProgress = localStorage.getItem(`testProgress_${testIdNum}`);
        if (savedProgress) {
            const progress = JSON.parse(savedProgress);
            // Предлагаем продолжить если прошло меньше 1 часа
            if (Date.now() - progress.timestamp < 3600000) {
                setCurrentQuestionIndex(progress.currentQuestionIndex);
                setUserAnswers(progress.userAnswers);
            }
        }
    }, [testIdNum]);

    if (!testData) {
        return <div>Тест не найден</div>;
    }

    const handleSelectAnswer = (answerIndex: number) => {
        setUserAnswers({
            ...userAnswers,
            [currentQuestion.id]: answerIndex
        });
    };

    const handleNextQuestion = () => {
        if (userAnswers[currentQuestion.id] === undefined) {
            alert('Пожалуйста, выберите ответ');
            return;
        }

        if (currentQuestionIndex < totalQuestions - 1) {
            setCurrentQuestionIndex(currentQuestionIndex + 1);
        } else {
            calculateAndNavigateToResults();
        }
    };

    const handlePreviousQuestion = () => {
        if (currentQuestionIndex > 0) {
            setCurrentQuestionIndex(currentQuestionIndex - 1);
        }
    };

    const calculateAndNavigateToResults = () => {
        // Правильно считаем результаты (0 = лучший ответ, 3 = худший)
        let totalScore = 0;
        const maxPossibleScore = totalQuestions * 3; // 3 балла за каждый вопрос

        testData.questions.forEach(question => {
            const userAnswer = userAnswers[question.id];
            // Инвертируем: 0 → 3 балла, 1 → 2 балла, 2 → 1 балл, 3 → 0 баллов
            const questionScore = 3 - userAnswer;
            totalScore += questionScore;
        });

        // Считаем процентиль (0-100%)
        const percentile = Math.round((totalScore / maxPossibleScore) * 100);

        const resultsData = {
            testId: testIdNum,
            testTitle: testData.title,
            category: testData.category,
            percentile: percentile,  // ← используем процентиль вместо score
            userAnswers
        };

        navigate(`/result`, { state: resultsData });  // ← измененный маршрут
    };

    return (
        <>
            <Header />
            <Container size="xl" style={{ minHeight: '100vh', padding: '40px 0' }}>
                <div style={{ textAlign: 'center', color: 'white', marginBottom: '40px' }}>
                    <Title order={1}>{testData.title}</Title>
                    <Text size="lg" style={{ color: 'rgba(255,255,255,0.8)' }}>
                        {testData.category}
                    </Text>
                </div>

                <Card shadow="md" p="xl" style={{ background: 'rgba(255,255,255,0.95)', borderRadius: '12px' }}>
                    <Stack gap="md" mb="xl">
                        <Group justify="space-between">
                            <Text fw={500}>
                                Вопрос {currentQuestionIndex + 1} из {totalQuestions}
                            </Text>
                            <Text fw={500} c="dimmed">
                                {Math.round(progress)}%
                            </Text>
                        </Group>
                        <Progress value={progress} size="lg" radius="md" />
                    </Stack>

                    <Stack gap="lg" mb="xl">
                        <div>
                            <Badge size="lg" mb="md" color="violet">
                                Вопрос {currentQuestionIndex + 1}
                            </Badge>
                            <Title order={2} size="h3" style={{ marginBottom: '30px', color: '#2c3e50' }}>
                                {currentQuestion.text}
                            </Title>
                        </div>

                        <Stack gap="md">
                            {currentQuestion.options.map((option, index) => (
                                <Card
                                    key={index}
                                    p="md"
                                    radius="md"
                                    style={{
                                        border: userAnswers[currentQuestion.id] === index
                                            ? '2px solid #667eea'
                                            : '2px solid #e0e0e0',
                                        background: userAnswers[currentQuestion.id] === index
                                            ? 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)'
                                            : 'white',
                                        cursor: 'pointer',
                                        transition: 'all 0.3s ease'
                                    }}
                                    onClick={() => handleSelectAnswer(index)}
                                    withBorder
                                >
                                    <Group>
                                        <div
                                            style={{
                                                width: '24px',
                                                height: '24px',
                                                borderRadius: '50%',
                                                border: '2px solid ' + (userAnswers[currentQuestion.id] === index ? 'white' : '#ccc'),
                                                display: 'flex',
                                                alignItems: 'center',
                                                justifyContent: 'center',
                                                backgroundColor: userAnswers[currentQuestion.id] === index ? 'white' : 'transparent'
                                            }}
                                        >
                                            {userAnswers[currentQuestion.id] === index && (
                                                <div style={{
                                                    width: '8px',
                                                    height: '8px',
                                                    backgroundColor: '#667eea',
                                                    borderRadius: '50%'
                                                }} />
                                            )}
                                        </div>
                                        <Text
                                            fw={500}
                                            style={{
                                                color: userAnswers[currentQuestion.id] === index ? 'white' : '#333'
                                            }}
                                        >
                                            {option}
                                        </Text>
                                    </Group>
                                </Card>
                            ))}
                        </Stack>
                    </Stack>

                    <Group justify="space-between" mt="xl">
                        <Button
                            variant="light"
                            disabled={currentQuestionIndex === 0}
                            onClick={handlePreviousQuestion}
                        >
                            ← Назад
                        </Button>
                        <Button
                            gradient={{ from: 'blue', to: 'cyan' }}
                            onClick={handleNextQuestion}
                        >
                            {currentQuestionIndex === totalQuestions - 1 ? 'Завершить →' : 'Далее →'}
                        </Button>
                    </Group>
                </Card>
            </Container>
        </>
    );
};

export default TestingPage;